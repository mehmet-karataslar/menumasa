<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Masa Men√º - Restoran ve kafe i≈ületmeleri i√ßin QR kod tabanlƒ± dijital men√º √ß√∂z√ºm√º. Kolay kurulum, indirim y√∂netimi ve m√º≈üteri deneyimi.">
  <meta name="keywords" content="dijital men√º, QR kod men√º, restoran men√º, kafe men√º, mobil men√º, masa men√º">
  <meta name="author" content="Masa Men√º">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Open Graph tags -->
  <meta property="og:title" content="Masa Men√º - Dijital Men√º √á√∂z√ºm√º">
  <meta property="og:description" content="QR kod ile dijital men√º sistemi. Restoran ve kafeler i√ßin modern √ß√∂z√ºm.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="icons/Icon-512.png">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Masa Men√º">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Masa Men√º - Dijital Men√º √á√∂z√ºm√º</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- QR Menu compatible routing script -->
  <script>
// Enhanced QR Menu and normal route handler
window.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ Enhanced QR Route Handler initialized');
  
  // Get current URL info
  const currentPath = window.location.pathname;
  const currentSearch = window.location.search;
  const searchParams = new URLSearchParams(currentSearch);
  
  console.log('üìç Current path:', currentPath);
  console.log('üìç Current search:', currentSearch);
  
  // Enhanced QR menu URL detection
  const isQRMenuURL = currentPath.includes('/menu/') ||
                     currentPath.includes('/qr-menu/') ||
                     currentPath === '/qr' ||
                     currentPath.startsWith('/qr?') ||
                     searchParams.has('business') ||
                     searchParams.has('businessId');
  
  console.log('üîç QR Detection Result:', {
    path: currentPath,
    search: currentSearch,
    isQRMenu: isQRMenuURL,
    hasBusiness: searchParams.has('business'),
    hasBusinessId: searchParams.has('businessId')
  });
  
  // Don't redirect QR menu URLs - let Flutter handle them
  if (isQRMenuURL) {
    console.log('‚úÖ QR Menu URL detected, preserving route:', currentPath + currentSearch);
    // Ensure Flutter can access the QR parameters
    window.qrRouteInfo = {
      originalPath: currentPath,
      originalSearch: currentSearch,
      businessId: searchParams.get('business') || searchParams.get('businessId'),
      tableNumber: searchParams.get('table') || searchParams.get('tableNumber'),
      timestamp: Date.now()
    };
    return; // Don't interfere with QR routes
  }
  
  // Clear cache for non-QR URLs
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(function(registrations) {
      for(let registration of registrations) {
        registration.update();
      }
    });
  }
  
  // Handle hash routing only for non-QR URLs
  if (window.location.hash && !isQRMenuURL) {
    const hash = window.location.hash.substring(1);
    const path = hash.split('?')[0];
    
    // Check if hash contains QR menu path
    if (path.includes('/menu/') || path.includes('/qr-menu/') || path.includes('/qr')) {
      console.log('‚úÖ QR Menu hash detected, preserving:', hash);
      return; // Don't redirect QR menu paths
    }
    
    // Only redirect non-QR hash routes
    if (path && path !== '/') {
      console.log('üîÑ Redirecting hash route to:', path);
      window.history.replaceState(null, '', path + window.location.search);
    }
  }
});

// Enhanced hash change handler
window.addEventListener('hashchange', function() {
  const hash = window.location.hash.substring(1);
  const path = hash.split('?')[0];
  
  // Don't interfere with QR menu URLs
  if (path && (path.includes('/menu/') || path.includes('/qr-menu/') || path.includes('/qr'))) {
    console.log('‚úÖ QR Menu hash change detected, preserving:', hash);
    return;
  }
  
  // Handle normal hash changes
  if (path && path !== window.location.pathname) {
    console.log('üîÑ Hash change redirect to:', path);
    window.history.replaceState(null, '', path + window.location.search);
  }
});

// QR URL helper function for Flutter
window.getQRRouteInfo = function() {
  return window.qrRouteInfo || null;
};

// Enhanced QR URL validator
window.validateQRUrl = function(url) {
  try {
    const uri = new URL(url, window.location.origin);
    const hasBusinessParam = uri.searchParams.has('business') || uri.searchParams.has('businessId');
    const hasQRPath = uri.pathname.includes('/menu/') || 
                     uri.pathname.includes('/qr-menu/') || 
                     uri.pathname === '/qr';
    
    return {
      isValid: hasBusinessParam || hasQRPath,
      businessId: uri.searchParams.get('business') || uri.searchParams.get('businessId'),
      tableNumber: uri.searchParams.get('table') || uri.searchParams.get('tableNumber'),
      originalUrl: url
    };
  } catch (e) {
    console.error('QR URL validation error:', e);
    return { isValid: false, error: e.message };
  }
};
</script>
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html> 